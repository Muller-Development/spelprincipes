<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbal Spelprincipes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50">
    <div id="app" class="p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">‚öΩ Voetbal Spelprincipes</h1>
                <p class="text-gray-600">Verzamel en stem op spelprincipes voor trainers</p>
            </div>

            <!-- Categorie√´n -->
            <div id="categories" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>

            <!-- Toevoeg knop -->
            <div class="mb-6">
                <button id="addBtn" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors">
                    <span>‚ûï</span>
                    <span id="addBtnText">Voeg spelprincipe toe</span>
                </button>
            </div>

            <!-- Formulier -->
            <div id="addForm" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="formTitle" class="text-lg font-semibold text-gray-800"></h3>
                    <button id="closeForm" class="text-gray-500 hover:text-gray-700 text-2xl">‚úï</button>
                </div>
                <textarea id="principleText" placeholder="Beschrijf het spelprincipe..." class="w-full p-3 border border-gray-300 rounded-lg mb-4 min-h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                <button id="saveBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                    Opslaan
                </button>
            </div>

            <!-- Principes lijst -->
            <div id="principlesList" class="space-y-4"></div>

            <!-- Footer info -->
            <div class="mt-12 text-center text-sm text-gray-600 bg-white rounded-lg p-4 shadow">
                <p class="mb-2">üí° <strong>Tip:</strong> Data wordt gedeeld met alle gebruikers. Stem op principes die je waardevol vindt!</p>
                <p>Totaal aantal principes: <strong id="totalCount">0</strong></p>
            </div>

            <!-- Loading -->
            <div id="loading" class="text-center text-xl text-gray-600 py-12">Laden...</div>
        </div>
    </div>

    <script>
     // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAN68XTo6WUpj9tkdVx_VdzAiVYqmNIbaI",
    authDomain: "spel-principes.firebaseapp.com",
    projectId: "spel-principes",
    storageBucket: "spel-principes.firebasestorage.app",
    messagingSenderId: "783487670370",
    appId: "1:783487670370:web:4e47838050ced3ede0d93b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

        
        const CATEGORIES = ['Aanvallen', 'Verdedigen', 'Balverlies', 'Balverovering'];
        let principles = [];
        let activeCategory = 'Aanvallen';
        let userId = getUserId();

        // Initialiseer app
        async function init() {
            await loadData();
            renderCategories();
            renderPrinciples();
            setupEventListeners();
            document.getElementById('loading').classList.add('hidden');
        }

        // User ID
        function getUserId() {
            let id = localStorage.getItem('voetbal_user_id');
            if (!id) {
                id = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('voetbal_user_id', id);
            }
            return id;
        }

        // Laad data
        async function loadData() {
            try {
                const keys = await window.storage.list('principle:');
                if (keys && keys.keys) {
                    const loadedPrinciples = [];
                    for (const key of keys.keys) {
                        try {
                            const result = await window.storage.get(key, true);
                            if (result) {
                                loadedPrinciples.push(JSON.parse(result.value));
                            }
                        } catch (err) {
                            console.log('Key niet gevonden:', key);
                        }
                    }
                    principles = loadedPrinciples;
                }
            } catch (error) {
                console.log('Eerste keer laden');
            }
        }

        // Render categorie√´n
        function renderCategories() {
            const container = document.getElementById('categories');
            container.innerHTML = CATEGORIES.map(category => {
                const count = principles.filter(p => p.category === category).length;
                const isActive = category === activeCategory;
                return `
                    <button onclick="setActiveCategory('${category}')" 
                        class="p-4 rounded-lg font-semibold transition-all ${
                            isActive 
                                ? 'bg-green-600 text-white shadow-lg scale-105' 
                                : 'bg-white text-gray-700 hover:bg-green-50'
                        }">
                        ${category}
                        <span class="block text-sm mt-1 opacity-75">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        // Render principes
        function renderPrinciples() {
            const container = document.getElementById('principlesList');
            const filtered = principles
                .filter(p => p.category === activeCategory)
                .sort((a, b) => b.likes - a.likes);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                        Nog geen spelprincipes in deze categorie. Wees de eerste om er een toe te voegen!
                    </div>
                `;
                document.getElementById('totalCount').textContent = principles.length;
                return;
            }

            container.innerHTML = filtered.map(principle => {
                const hasLiked = principle.likedBy.includes(userId);
                return `
                    <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6">
                        <div class="flex gap-4">
                            <button onclick="toggleLike('${principle.id}')" 
                                class="flex flex-col items-center justify-center min-w-16 ${
                                    hasLiked ? 'text-blue-600' : 'text-gray-400 hover:text-blue-600'
                                } transition-colors">
                                <span class="text-2xl">${hasLiked ? 'üëç' : 'üëçüèª'}</span>
                                <span class="text-sm font-semibold mt-1">${principle.likes}</span>
                            </button>
                            <div class="flex-1">
                                <p class="text-gray-800 leading-relaxed">${escapeHtml(principle.text)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('totalCount').textContent = principles.length;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Set active category
        function setActiveCategory(category) {
            activeCategory = category;
            renderCategories();
            renderPrinciples();
            document.getElementById('addBtnText').textContent = `Voeg spelprincipe toe aan ${category}`;
        }

        // Toggle like
        async function toggleLike(principleId) {
            const principle = principles.find(p => p.id === principleId);
            if (!principle) return;

            const hasLiked = principle.likedBy.includes(userId);
            principle.likes = hasLiked ? principle.likes - 1 : principle.likes + 1;
            principle.likedBy = hasLiked 
                ? principle.likedBy.filter(id => id !== userId)
                : [...principle.likedBy, userId];

            try {
                await window.storage.set(`principle:${principleId}`, JSON.stringify(principle), true);
                renderPrinciples();
                renderCategories();
            } catch (error) {
                alert('Fout bij liken: ' + error.message);
            }
        }

        // Add principle
        async function addPrinciple() {
            const text = document.getElementById('principleText').value.trim();
            if (!text) return;

            const principle = {
                id: Date.now().toString(),
                category: activeCategory,
                text: text,
                likes: 0,
                likedBy: []
            };

            try {
                await window.storage.set(`principle:${principle.id}`, JSON.stringify(principle), true);
                principles.push(principle);
                document.getElementById('principleText').value = '';
                document.getElementById('addForm').classList.add('hidden');
                renderPrinciples();
                renderCategories();
            } catch (error) {
                alert('Fout bij opslaan: ' + error.message);
            }
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('addBtn').addEventListener('click', () => {
                document.getElementById('addForm').classList.remove('hidden');
                document.getElementById('formTitle').textContent = `Nieuw principe: ${activeCategory}`;
            });

            document.getElementById('closeForm').addEventListener('click', () => {
                document.getElementById('addForm').classList.add('hidden');
            });

            document.getElementById('saveBtn').addEventListener('click', addPrinciple);

            document.getElementById('principleText').addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    addPrinciple();
                }
            });
        }

        // Start app
        init();
    </script>
</body>
</html>
