<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voetbal Spelprincipes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50">
    <div id="app" class="p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">âš½ Voetbal Spelprincipes</h1>
                <p class="text-gray-600">Verzamel en stem op spelprincipes voor trainers</p>
            </div>

            <!-- CategorieÃ«n -->
            <div id="categories" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>

            <!-- Toevoeg knop -->
            <div class="mb-6">
                <button id="addBtn" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors">
                    <span>â•</span>
                    <span id="addBtnText">Voeg spelprincipe toe</span>
                </button>
            </div>

            <!-- Formulier -->
            <div id="addForm" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="formTitle" class="text-lg font-semibold text-gray-800"></h3>
                    <button id="closeForm" class="text-gray-500 hover:text-gray-700 text-2xl">âœ•</button>
                </div>
                <textarea id="principleText" placeholder="Beschrijf het spelprincipe..." class="w-full p-3 border border-gray-300 rounded-lg mb-4 min-h-24 focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                <button id="saveBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors">
                    Opslaan
                </button>
            </div>

            <!-- Principes lijst -->
            <div id="principlesList" class="space-y-4"></div>

            <!-- Footer info -->
            <div class="mt-12 text-center text-sm text-gray-600 bg-white rounded-lg p-4 shadow">
                <p class="mb-2">ğŸ’¡ <strong>Tip:</strong> Data wordt gedeeld met alle gebruikers. Stem op principes die je waardevol vindt!</p>
                <p>Totaal aantal principes: <strong id="totalCount">0</strong></p>
            </div>

            <!-- Loading -->
            <div id="loading" class="text-center text-xl text-gray-600 py-12">
                <div class="animate-pulse">Laden...</div>
            </div>

            <!-- Error -->
            <div id="error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <strong>Fout:</strong> <span id="errorMessage"></span>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // ========================================
        // ğŸ”¥ FIREBASE CONFIGURATIE - PAS DIT AAN!
        // ========================================
        // Vervang onderstaande waardes met jouw eigen Firebase config
        // die je krijgt in Firebase Console > Project Settings > Your apps
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAN68XTo6WUpj9tkdVx_VdzAiVYqmNIbaI",
            authDomain: "spel-principes.firebaseapp.com",
            projectId: "spel-principes",
            storageBucket: "spel-principes.firebasestorage.app",
            messagingSenderId: "783487670370",
            appId: "1:783487670370:web:4e47838050ced3ede0d93b"
        };

        // ========================================
        // APPLICATIE CODE (niet aanpassen)
        // ========================================

        let app, db;
        
        // Initialiseer Firebase
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log('Firebase verbonden!');
        } catch (error) {
            showError('Firebase configuratie fout: ' + error.message);
            document.getElementById('loading').classList.add('hidden');
        }

        const CATEGORIES = ['Aanvallen', 'Verdedigen', 'Balverlies', 'Balverovering'];
        let principles = [];
        let activeCategory = 'Aanvallen';
        let userId = getUserId();

        // User ID
        function getUserId() {
            let id = localStorage.getItem('voetbal_user_id');
            if (!id) {
                id = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('voetbal_user_id', id);
            }
            return id;
        }

        // Show error
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.remove('hidden');
        }

        // Laad data van Firebase met real-time updates
        async function loadData() {
            try {
                const q = query(collection(db, 'principles'));
                
                // Real-time listener
                onSnapshot(q, (snapshot) => {
                    principles = [];
                    snapshot.forEach((doc) => {
                        principles.push({ id: doc.id, ...doc.data() });
                    });
                    renderCategories();
                    renderPrinciples();
                    document.getElementById('loading').classList.add('hidden');
                }, (error) => {
                    showError('Fout bij laden: ' + error.message);
                    document.getElementById('loading').classList.add('hidden');
                });
            } catch (error) {
                showError('Fout bij verbinden met database: ' + error.message);
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // Render categorieÃ«n
        function renderCategories() {
            const container = document.getElementById('categories');
            container.innerHTML = CATEGORIES.map(category => {
                const count = principles.filter(p => p.category === category).length;
                const isActive = category === activeCategory;
                return `
                    <button onclick="window.setActiveCategory('${category}')" 
                        class="p-4 rounded-lg font-semibold transition-all ${
                            isActive 
                                ? 'bg-green-600 text-white shadow-lg scale-105' 
                                : 'bg-white text-gray-700 hover:bg-green-50'
                        }">
                        ${category}
                        <span class="block text-sm mt-1 opacity-75">(${count})</span>
                    </button>
                `;
            }).join('');
        }

        // Render principes
        function renderPrinciples() {
            const container = document.getElementById('principlesList');
            const filtered = principles
                .filter(p => p.category === activeCategory)
                .sort((a, b) => b.likes - a.likes);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                        Nog geen spelprincipes in deze categorie. Wees de eerste om er een toe te voegen!
                    </div>
                `;
                document.getElementById('totalCount').textContent = principles.length;
                return;
            }

            container.innerHTML = filtered.map(principle => {
                const hasLiked = principle.likedBy && principle.likedBy.includes(userId);
                const isOwner = principle.createdBy === userId;
                return `
                    <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6">
                        <div class="flex gap-4">
                            <button onclick="window.toggleLike('${principle.id}')" 
                                class="flex flex-col items-center justify-center min-w-16 ${
                                    hasLiked ? 'text-blue-600' : 'text-gray-400 hover:text-blue-600'
                                } transition-colors">
                                <span class="text-2xl">${hasLiked ? 'ğŸ‘' : 'ğŸ‘ğŸ»'}</span>
                                <span class="text-sm font-semibold mt-1">${principle.likes || 0}</span>
                            </button>
                            <div class="flex-1">
                                <p class="text-gray-800 leading-relaxed">${escapeHtml(principle.text)}</p>
                            </div>
                            ${isOwner ? `
                                <button onclick="window.deletePrinciple('${principle.id}')" 
                                    class="text-red-500 hover:text-red-700 transition-colors self-start"
                                    title="Verwijder">
                                    <span class="text-xl">ğŸ—‘ï¸</span>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('totalCount').textContent = principles.length;
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Set active category
        window.setActiveCategory = function(category) {
            activeCategory = category;
            renderCategories();
            renderPrinciples();
            document.getElementById('addBtnText').textContent = `Voeg spelprincipe toe aan ${category}`;
        }

        // Toggle like
        window.toggleLike = async function(principleId) {
            const principle = principles.find(p => p.id === principleId);
            if (!principle) return;

            const likedBy = principle.likedBy || [];
            const hasLiked = likedBy.includes(userId);
            
            const newLikes = hasLiked ? (principle.likes || 0) - 1 : (principle.likes || 0) + 1;
            const newLikedBy = hasLiked 
                ? likedBy.filter(id => id !== userId)
                : [...likedBy, userId];

            try {
                const principleRef = doc(db, 'principles', principleId);
                await updateDoc(principleRef, {
                    likes: newLikes,
                    likedBy: newLikedBy
                });
            } catch (error) {
                showError('Fout bij liken: ' + error.message);
            }
        }

        // Delete principle
        window.deletePrinciple = async function(principleId) {
            if (!confirm('Weet je zeker dat je dit spelprincipe wilt verwijderen?')) {
                return;
            }

            try {
                const principleRef = doc(db, 'principles', principleId);
                await deleteDoc(principleRef);
            } catch (error) {
                showError('Fout bij verwijderen: ' + error.message);
            }
        }

        // Add principle
        async function addPrinciple() {
            const text = document.getElementById('principleText').value.trim();
            if (!text) return;

            const principle = {
                category: activeCategory,
                text: text,
                likes: 0,
                likedBy: [],
                createdBy: userId,
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'principles'), principle);
                document.getElementById('principleText').value = '';
                document.getElementById('addForm').classList.add('hidden');
            } catch (error) {
                showError('Fout bij opslaan: ' + error.message);
            }
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('addBtn').addEventListener('click', () => {
                document.getElementById('addForm').classList.remove('hidden');
                document.getElementById('formTitle').textContent = `Nieuw principe: ${activeCategory}`;
            });

            document.getElementById('closeForm').addEventListener('click', () => {
                document.getElementById('addForm').classList.add('hidden');
            });

            document.getElementById('saveBtn').addEventListener('click', addPrinciple);

            document.getElementById('principleText').addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    addPrinciple();
                }
            });
        }

        // Start app
        if (db) {
            setupEventListeners();
            loadData();
        }
    </script>
</body>
</html>
